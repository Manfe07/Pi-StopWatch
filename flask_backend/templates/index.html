<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<link href="../static/css/main.css" rel="stylesheet" type="text/css">
		<link rel="icon" type="image/png" href="../static/img/time-tracking.png">
		<title id="title">Stopwatch</title>
		<!--The following script tag downloads a font from the Adobe Edge Web Fonts server for use within the web page. We recommend that you do not modify it.-->
		<script>var __adobewebfontsappname__="dreamweaver"</script>   
		<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
		<!--<script src="http://use.edgefonts.net/allerta:n4:default;carme:n4:default.js" type="text/javascript"></script>-->
		<audio id="horn_short" preload="auto"><source src="../static/sounds/horn_short.mp3" /></audio>
		<audio id="horn_start" preload="auto"><source src="../static/sounds/horn_aoe.mp3" /></audio>
	</head>
    <body id="mainpage">
		<h1 id="headline" align="center">Stopwatch</h1>
		<div class="container" align="center" id="timetable_container">
			<p>
				<img src="../static/img/raceflags.png" width="20%"><br>
				Startzeit: <a id="start_time">00:00:00:00:00</a><br>
				Bahn_1: <a id="lane_1">000.00</a><br>
				Bahn_2: <a id="lane_2">000.00</a><br>
				Bahn_3: <a id="lane_3">000.00</a><br>
			</p>
		</div>	
		<div class="container" align="center" id="runtime_container">
			<img id="run_gif" src="../static/img/0.gif" height="30%"><br>
			<a class="runtime" id="runtime_time">000.00</a>
		</div>
		<div class="container" id="misc_container" align="center">
			<p>
				<a class="button_indicator" id="button_1">Button 1</a>
				<a class="button_indicator" id="button_2">Button 2</a>
				<a class="button_indicator" id="button_3">Button 3</a>
			</p>
			<p>IP: <a id="ip_adress">000.000.000.000</a></p>
		</div>
		</body>
	
	<script>
		url = window.location.href;
		race_activ = true;
	
		function get_IP(){
			$.getJSON(url + '/get_ip', function(data) {
				document.getElementById("ip_adress").innerHTML = data.ip;
				});
			return 0
		}
		
		function refresh_IO(){
			$.getJSON(url + '/data', function(data) {
				button1 = document.getElementById("button_1");
				button2 = document.getElementById("button_2");
				button3 = document.getElementById("button_3");
				document.getElementById("start_time").innerHTML = data.start_time;
				document.getElementById("runtime_time").innerHTML = data.runtime;
				document.getElementById("lane_1").innerHTML = data.time_1;
				
				//Change between TimeTable and Runtime
			 	var a = document.getElementById("timetable_container");
				var b = document.getElementById("runtime_container");
				var c = document.getElementById("misc_container")
				
				if (data.running == false && race_activ == true) {
					race_activ = false;
					document.getElementById('horn_short').play();
					change_gif();
					document.getElementById("title").innerHTML = "Stopwatch";
					document.getElementById("headline").innerHTML = "Stopwatch";
					a.style.display = "block";
					b.style.display = "none";
					c.style.display = "block";
				} else if(data.running == true && race_activ == false){
					race_activ = true;
					document.getElementById('horn_start').play();
					document.getElementById("title").innerHTML = "!!! - RACE IS GOING - !!!";
					document.getElementById("headline").innerHTML = "!!! - RACE IS GOING - !!!";
					a.style.display = "none";
					b.style.display = "block";
					c.style.display = "none";
				}

				if(data.Button_1 == true){button1.style.background = "red"} else {button1.style.background = "lime";}
				if(data.Button_2 == true){button2.style.background = "red"} else {button2.style.background = "lime";}
				if(data.Button_3 == true){button3.style.background = "red"} else {button3.style.background = "lime";}
				});
			return 0
		}
		
		function change_gif(){
			nr = Math.floor(Math.random() * 4);
			document.getElementById("run_gif").src = "../static/img/" + nr + ".gif";
		}
		
		function formatFloat(zahl){
			return Math.round(zahl*100)/100;
		}
		
		get_IP();
		setInterval(refresh_IO,200);
		setInterval(get_IP,10000)
	</script>		
</html>